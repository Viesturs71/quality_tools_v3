{% load static %}
{% load i18n %}

<nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse" id="sidebarMenu">
        <div class="position-sticky pt-3">
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}" href="{% url 'home' %}">
                <i class="fas fa-home"></i>
{% trans "Dashboard" %}
            </a>
        </li>

                    {% if user_modules %}
                {% for module in user_modules %}
                    <li class="nav-item">
                        <a class="nav-link d-flex justify-content-between align-items-center" 
                           data-bs-toggle="collapse" 
                           href="#collapse{{ forloop.counter }}" 
                           role="button" 
                           aria-expanded="false" 
                           aria-controls="collapse{{ forloop.counter }}">
{% if module.icon %}<i class="{{ module.icon }} me-2"></i>{% endif %}
                            <span>{{ module.name }}</span>
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <div class="collapse" id="collapse{{ forloop.counter }}">
<ul class="nav flex-column">
                            {% for submodule in module.submodules %}
                                <li class="nav-item">
                                    <a class="nav-link ps-4 {% if request.resolver_match.url_name == submodule.url_name|cut:':' %}active{% endif %}" 
href="{% url submodule.url_name %}">
                                        {% if submodule.icon %}
                                            <i class="{{ submodule.icon }} me-2"></i>
                                        {% endif %}
                                        {{ submodule.name }}
{% if submodule.badge %}
                                            <span class="badge bg-danger ms-2">{{ submodule.badge }}</span>
                                        {% endif %}
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
</div>
                    </li>
                {% endfor %}
            {% endif %}

            {% if user.is_authenticated %}
            <li class="nav-item">
                <a class="nav-link" href="{% url 'logout' %}">
                    <i class="fas fa-sign-out-alt"></i>
                    {% trans "Logout" %}
                </a>
            </li>
        {% endif %}
    </ul>
</div>
</nav>

<script>
document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.submenu-trigger').forEach(trigger => {
        const parent = trigger.closest('li.menu-parent');
        const submenu = parent.querySelector('.submenu-content');
        const symbol = trigger.querySelector('.toggle-symbol');

        trigger.addEventListener('click', (e) => {
            e.preventDefault();

            if (submenu.classList.contains('show')) {
                submenu.classList.remove('show');
                parent.classList.remove('active');
                symbol.textContent = '▶';
                symbol.style.color = 'black';
            } else {
                submenu.classList.add('show');
                parent.classList.add('active');
                symbol.textContent = '▼';
                symbol.style.color = 'black';
            }
        });
    });
});
</script>
